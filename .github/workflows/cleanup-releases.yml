name: ğŸ§¹ Nettoyage des Releases

# DÃ©clenchement manuel uniquement
on:
  workflow_dispatch:
    inputs:
      version_to_delete:
        description: 'Version Ã  supprimer (ex: 1.0.0)'
        required: true
        type: string
      delete_tag:
        description: 'Supprimer aussi le tag Git?'
        required: true
        type: boolean
        default: false

permissions:
  contents: write
  actions: read

jobs:
  cleanup:
    name: ğŸ—‘ï¸ Suppression de Release
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ” VÃ©rification des paramÃ¨tres
        run: |
          VERSION="${{ github.event.inputs.version_to_delete }}"
          DELETE_TAG="${{ github.event.inputs.delete_tag }}"
          
          echo "Version Ã  supprimer: $VERSION"
          echo "Supprimer le tag: $DELETE_TAG"
          
          if [ -z "$VERSION" ]; then
            echo "âŒ Version manquante"
            exit 1
          fi

      - name: ğŸ—‘ï¸ Suppression de la release
        run: |
          VERSION="${{ github.event.inputs.version_to_delete }}"
          TAG="v$VERSION"
          
          echo "ğŸ” VÃ©rification de l'existence de la release $TAG..."
          
          if gh release view "$TAG" &>/dev/null; then
            echo "ğŸ—‘ï¸ Suppression de la release $TAG..."
            gh release delete "$TAG" --yes
            echo "âœ… Release $TAG supprimÃ©e"
          else
            echo "âš ï¸ Release $TAG n'existe pas"
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ·ï¸ Suppression du tag (optionnel)
        if: github.event.inputs.delete_tag == 'true'
        run: |
          VERSION="${{ github.event.inputs.version_to_delete }}"
          TAG="v$VERSION"
          
          echo "ğŸ—‘ï¸ Suppression du tag $TAG..."
          
          # Supprimer le tag local (peut Ã©chouer si pas prÃ©sent)
          git tag -d "$TAG" 2>/dev/null || echo "Tag local absent"
          
          # Supprimer le tag distant
          git push origin ":refs/tags/$TAG" 2>/dev/null || echo "Tag distant absent"
          
          echo "âœ… Tag $TAG supprimÃ©"

      - name: ğŸ“‹ Lister les releases restantes
        run: |
          echo "ğŸ“‹ Releases actuelles:"
          gh release list || echo "Aucune release trouvÃ©e"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}